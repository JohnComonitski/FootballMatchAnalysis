from FootballMatchAnalysis.analysis.utils import *
import numpy as np

def boxes_missing(quandrant, zone):
    box1 = None
    box2 = None
    box3 = None
    box4 = None
    box5 = None
    box6 = None
    box7 = None
    box8 = None

    if quandrant == 1:
        if zone % 12 == 1:
            box1 = True
            box2 = True
        if zone < 13:
            box1 = True
            box4 = True
    elif quandrant == 2:
        if zone % 12 == 1:
            box2 = True
            box3 = True
        if zone > 180:
            box3 = True
            box5 = True
    elif quandrant == 3:
        if zone % 12 == 0:
            box6 = True
            box7 = True
        if zone < 13:
            box4 = True
            box6 = True
    elif quandrant == 4:
        if zone % 12 == 0:
            box7 = True
            box8 = True
        if zone > 180:
            box5 = True
            box8 = True

    return [ box1, box2, box3, box4, box5, box6, box7, box8 ]

def get_four_boxes(coords):
    mapping = xt_map_zones()
    zone = int(get_zone(coords))
    quandrant = get_quadrant(coords, zone, mapping)
    x, y = coords

    directions = {
        "1" : ( -6.625, 5.66 ),
        "2" : ( 0, 5.66 ),
        "3" : ( 6.625, 5.66 ),
        "4" : ( -6.625, 0 ),
        "5" : ( 6.625, 0 ),
        "6" : ( -6.625, -5.66 ),
        "7" : ( 0, -5.66 ),
        "8" : ( 6.625, -5.66 )
    }

    boxes_to_invent = boxes_missing(quandrant, zone)

    val = zone_to_xt(str(zone))
    boxes = [ { "value" : val, "box" : mapping[str(zone)] } ]

    needed = []
    if quandrant == 1:
        needed = [ 1, 2, 4 ]
    elif quandrant == 2:
        needed = [ 2, 3, 5 ]
    elif quandrant == 3:
        needed = [ 4, 6, 7 ]
    elif quandrant == 4:
        needed = [ 5, 7, 8 ]

    for box in needed:
        direction = directions[str(box)]
        new_box = {
            "value" : 0,
            "box" : None
        }

        if boxes_to_invent[box - 1]:
            new_box["value"] = val
            invented_box = []
            for p in mapping[str(zone)]:
                invented_box.append([ p[0] + direction[0], p[1] + direction[1] ])
            new_box["box"] = invented_box
        else:
            new_x = x + direction[0]
            new_y = y + direction[1]
            new_zone = get_zone((new_x, new_y))
            new_box["value"] = zone_to_xt(new_zone)
            new_box["box"] = mapping[new_zone]

        boxes.append(new_box)
                
    return boxes

def xt_map_zones():
    # 12 x 16
    # -53 -> 53
    # 34 -> -34 
    # 6.625 x 5.66
    return {
        "1" : [ [-53.0, 34.0], [-53.0, 28.34], [-46.375, 34.0], [-46.375, 28.34] ],
        "2" : [ [-53.0, 28.34], [-53.0, 22.68], [-46.375, 28.34], [-46.375, 22.68] ],
        "3" : [ [-53.0, 22.68], [-53.0, 17.02], [-46.375, 22.68], [-46.375, 17.02] ],
        "4" : [ [-53.0, 17.02], [-53.0, 11.36], [-46.375, 17.02], [-46.375, 11.36] ],
        "5" : [ [-53.0, 11.36], [-53.0, 5.7], [-46.375, 11.36], [-46.375, 5.7] ],
        "6" : [ [-53.0, 5.7], [-53.0, 0.0], [-46.375, 5.7], [-46.375, 0.0] ],
        "7" : [ [-53.0, 0.0], [-53.0, -5.66], [-46.375, 0.0], [-46.375, -5.66] ],
        "8" : [ [-53.0, -5.66], [-53.0, -11.32], [-46.375, -5.66], [-46.375, -11.32] ],
        "9" : [ [-53.0, -11.32], [-53.0, -16.98], [-46.375, -11.32], [-46.375, -16.98] ],
        "10" : [ [-53.0, -16.98], [-53.0, -22.64], [-46.375, -16.98], [-46.375, -22.64] ],
        "11" : [ [-53.0, -22.64], [-53.0, -28.3], [-46.375, -22.64], [-46.375, -28.3] ],
        "12" : [ [-53.0, -28.3], [-53.0, -34], [-46.375, -28.3], [-46.375, -34] ],
        "13" : [ [-46.375, 34.0], [-46.375, 28.34], [-39.75, 34.0], [-39.75, 28.34] ],
        "14" : [ [-46.375, 28.34], [-46.375, 22.68], [-39.75, 28.34], [-39.75, 22.68] ],
        "15" : [ [-46.375, 22.68], [-46.375, 17.02], [-39.75, 22.68], [-39.75, 17.02] ],
        "16" : [ [-46.375, 17.02], [-46.375, 11.36], [-39.75, 17.02], [-39.75, 11.36] ],
        "17" : [ [-46.375, 11.36], [-46.375, 5.7], [-39.75, 11.36], [-39.75, 5.7] ],
        "18" : [ [-46.375, 5.7], [-46.375, 0.0], [-39.75, 5.7], [-39.75, 0.0] ],
        "19" : [ [-46.375, 0.0], [-46.375, -5.66], [-39.75, 0.0], [-39.75, -5.66] ],
        "20" : [ [-46.375, -5.66], [-46.375, -11.32], [-39.75, -5.66], [-39.75, -11.32] ],
        "21" : [ [-46.375, -11.32], [-46.375, -16.98], [-39.75, -11.32], [-39.75, -16.98] ],
        "22" : [ [-46.375, -16.98], [-46.375, -22.64], [-39.75, -16.98], [-39.75, -22.64] ],
        "23" : [ [-46.375, -22.64], [-46.375, -28.3], [-39.75, -22.64], [-39.75, -28.3] ],
        "24" : [ [-46.375, -28.3], [-46.375, -34], [-39.75, -28.3], [-39.75, -34] ],
        "25" : [ [-39.75, 34.0], [-39.75, 28.34], [-33.125, 34.0], [-33.125, 28.34] ],
        "26" : [ [-39.75, 28.34], [-39.75, 22.68], [-33.125, 28.34], [-33.125, 22.68] ],
        "27" : [ [-39.75, 22.68], [-39.75, 17.02], [-33.125, 22.68], [-33.125, 17.02] ],
        "28" : [ [-39.75, 17.02], [-39.75, 11.36], [-33.125, 17.02], [-33.125, 11.36] ],
        "29" : [ [-39.75, 11.36], [-39.75, 5.7], [-33.125, 11.36], [-33.125, 5.7] ],
        "30" : [ [-39.75, 5.7], [-39.75, 0.0], [-33.125, 5.7], [-33.125, 0.0] ],
        "31" : [ [-39.75, 0.0], [-39.75, -5.66], [-33.125, 0.0], [-33.125, -5.66] ],
        "32" : [ [-39.75, -5.66], [-39.75, -11.32], [-33.125, -5.66], [-33.125, -11.32] ],
        "33" : [ [-39.75, -11.32], [-39.75, -16.98], [-33.125, -11.32], [-33.125, -16.98] ],
        "34" : [ [-39.75, -16.98], [-39.75, -22.64], [-33.125, -16.98], [-33.125, -22.64] ],
        "35" : [ [-39.75, -22.64], [-39.75, -28.3], [-33.125, -22.64], [-33.125, -28.3] ],
        "36" : [ [-39.75, -28.3], [-39.75, -34], [-33.125, -28.3], [-33.125, -34] ],
        "37" : [ [-33.125, 34.0], [-33.123, 28.34], [-26.5, 34.0], [-26.5, 28.34] ],
        "38" : [ [-33.125, 28.34], [-33.125, 22.68], [-26.5, 28.34], [-26.5, 22.68] ],
        "39" : [ [-33.125, 22.68], [-33.125, 17.02], [-26.5, 22.68], [-26.5, 17.02] ],
        "40" : [ [-33.125, 17.02], [-33.125, 11.36], [-26.5, 17.02], [-26.5, 11.36] ],
        "41" : [ [-33.125, 11.36], [-33.125, 5.7], [-26.5, 11.36], [-26.5, 5.7] ],
        "42" : [ [-33.125, 5.7], [-33.125, 0.0], [-26.5, 5.7], [-26.5, 0.0] ],
        "43" : [ [-33.125, 0.0], [-33.125, -5.66], [-26.5, 0.0], [-26.5, -5.66] ],
        "44" : [ [-33.125, -5.66], [-33.125, -11.32], [-26.5, -5.66], [-26.5, -11.32] ],
        "45" : [ [-33.125, -11.32], [-33.125, -16.98], [-26.5, -11.32], [-26.5, -16.98] ],
        "46" : [ [-33.125, -16.98], [-33.125, -22.64], [-26.5, -16.98], [-26.5, -22.64] ],
        "47" : [ [-33.125, -22.64], [-33.125, -28.3], [-26.5, -22.64], [-26.5, -28.3] ],
        "48" : [ [-33.125, -28.3], [-33.125, -34], [-26.5, -28.3], [-26.5, -34] ],
        "49" : [ [-26.5, 34.0], [-26.5, 28.34], [-19.875, 34.0], [-19.875, 28.34] ],
        "50" : [ [-26.5, 28.34], [-26.5, 22.68], [-19.875, 28.34], [-19.875, 22.68] ],
        "51" : [ [-26.5, 22.68], [-26.5, 17.02], [-19.875, 22.68], [-19.875, 17.02] ],
        "52" : [ [-26.5, 17.02], [-26.5, 11.36], [-19.875, 17.02], [-19.875, 11.36] ],
        "53" : [ [-26.5, 11.36], [-26.5, 5.7], [-19.875, 11.36], [-19.875, 5.7] ],
        "54" : [ [-26.5, 5.7], [-26.5, 0.0], [-19.875, 5.7], [-19.875, 0.0] ],
        "55" : [ [-26.5, 0.0], [-26.5, -5.66], [-19.875, 0.0], [-19.875, -5.66] ],
        "56" : [ [-26.5, -5.66], [-26.5, -11.32], [-19.875, -5.66], [-19.875, -11.32] ],
        "57" : [ [-26.5, -11.32], [-26.5, -16.98], [-19.875, -11.32], [-19.875, -16.98] ],
        "58" : [ [-26.5, -16.98], [-26.5, -22.64], [-19.875, -16.98], [-19.875, -22.64] ],
        "59" : [ [-26.5, -22.64], [-26.5, -28.3], [-19.875, -22.64], [-19.875, -28.3] ],
        "60" : [ [-26.5, -28.3], [-26.5, -34], [-19.875, -28.3], [-19.875, -34] ],
        "61" : [ [-19.875, 34.0], [-19.875, 28.34], [-13.25, 34.0], [-13.25, 28.34] ],
        "62" : [ [-19.875, 28.34], [-19.875, 22.68], [-13.25, 28.34], [-13.25, 22.68] ],
        "63" : [ [-19.875, 22.68], [-19.875, 17.02], [-13.25, 22.68], [-13.25, 17.02] ],
        "64" : [ [-19.875, 17.02], [-19.875, 11.36], [-13.25, 17.02], [-13.25, 11.36] ],
        "65" : [ [-19.875, 11.36], [-19.875, 5.7], [-13.25, 11.36], [-13.25, 5.7] ],
        "66" : [ [-19.875, 5.7], [-19.875, 0.0], [-13.25, 5.7], [-13.25, 0.0] ],
        "67" : [ [-19.875, 0.0], [-19.875, -5.66], [-13.25, 0.0], [-13.25, -5.66] ],
        "68" : [ [-19.875, -5.66], [-19.875, -11.32], [-13.25, -5.66], [-13.25, -11.32] ],
        "69" : [ [-19.875, -11.32], [-19.875, -16.98], [-13.25, -11.32], [-13.25, -16.98] ],
        "70" : [ [-19.875, -16.98], [-19.875, -22.64], [-13.25, -16.98], [-13.25, -22.64] ],
        "71" : [ [-19.875, -22.64], [-19.875, -28.3], [-13.25, -22.64], [-13.25, -28.3] ],
        "72" : [ [-19.875, -28.3], [-19.875, -34], [-13.25, -28.3], [-13.25, -34] ],
        "73" : [ [-13.25, 34.0], [-13.25, 28.34], [-6.625, 34.0], [-6.625, 28.34] ],
        "74" : [ [-13.25, 28.34], [-13.25, 22.68], [-6.625, 28.34], [-6.625, 22.68] ],
        "75" : [ [-13.25, 22.68], [-13.25, 17.02], [-6.625, 22.68], [-6.625, 17.02] ],
        "76" : [ [-13.25, 17.02], [-13.25, 11.36], [-6.625, 17.02], [-6.625, 11.36] ],
        "77" : [ [-13.25, 11.36], [-13.25, 5.7], [-6.625, 11.36], [-6.625, 5.7] ],
        "78" : [ [-13.25, 5.7], [-13.25, 0.0], [-6.625, 5.7], [-6.625, 0.0] ],
        "79" : [ [-13.25, 0.0], [-13.25, -5.66], [-6.625, 0.0], [-6.625, -5.66] ],
        "80" : [ [-13.25, -5.66], [-13.25, -11.32], [-6.625, -5.66], [-6.625, -11.32] ],
        "81" : [ [-13.25, -11.32], [-13.25, -16.98], [-6.625, -11.32], [-6.625, -16.98] ],
        "82" : [ [-13.25, -16.98], [-13.25, -22.64], [-6.625, -16.98], [-6.625, -22.64] ],
        "83" : [ [-13.25, -22.64], [-13.25, -28.3], [-6.625, -22.64], [-6.625, -28.3] ],
        "84" : [ [-13.25, -28.3], [-13.25, -34], [-6.625, -28.3], [-6.625, -34] ],
        "85" : [ [-6.625, 34.0], [-6.625, 28.34], [0.0, 34.0], [0.0, 28.34] ],
        "86" : [ [-6.625, 28.34], [-6.625, 22.68], [0.0, 28.34], [0.0, 22.68] ],
        "87" : [ [-6.625, 22.68], [-6.625, 17.02], [0.0, 22.68], [0.0, 17.02] ],
        "88" : [ [-6.625, 17.02], [-6.625, 11.36], [0.0, 17.02], [0.0, 11.36] ],
        "89" : [ [-6.625, 11.36], [-6.625, 5.7], [0.0, 11.36], [0.0, 5.7] ],
        "90" : [ [-6.625, 5.7], [-6.625, 0.0], [0.0, 5.7], [0.0, 0.0] ],
        "91" : [ [-6.625, 0.0], [-6.625, -5.66], [0.0, 0.0], [0.0, -5.66] ],
        "92" : [ [-6.625, -5.66], [-6.625, -11.32], [0.0, -5.66], [0.0, -11.32] ],
        "93" : [ [-6.625, -11.32], [-6.625, -16.98], [0.0, -11.32], [0.0, -16.98] ],
        "94" : [ [-6.625, -16.98], [-6.625, -22.64], [0.0, -16.98], [0.0, -22.64] ],
        "95" : [ [-6.625, -22.64], [-6.625, -28.3], [0.0, -22.64], [0.0, -28.3] ],
        "96" : [ [-6.625, -28.3], [-6.625, -34], [0.0, -28.3], [0.0, -34] ],
        "97" : [ [0.0, 34.0], [0.0, 28.34], [6.625, 34.0], [6.625, 28.34] ],
        "98" : [ [0.0, 28.34], [0.0, 22.68], [6.625, 28.34], [6.625, 22.68] ],
        "99" : [ [0.0, 22.68], [0.0, 17.02], [6.625, 22.68], [6.625, 17.02] ],
        "100" : [ [0.0, 17.02], [0.0, 11.36], [6.625, 17.02], [6.625, 11.36] ],
        "101" : [ [0.0, 11.36], [0.0, 5.7], [6.625, 11.36], [6.625, 5.7] ],
        "102" : [ [0.0, 5.7], [0.0, 0.0], [6.625, 5.7], [6.625, 0.0] ],
        "103" : [ [0.0, 0.0], [0.0, -5.66], [6.625, 0.0], [6.625, -5.66] ],
        "104" : [ [0.0, -5.66], [0.0, -11.32], [6.625, -5.66], [6.625, -11.32] ],
        "105" : [ [0.0, -11.32], [0.0, -16.98], [6.625, -11.32], [6.625, -16.98] ],
        "106" : [ [0.0, -16.98], [0.0, -22.64], [6.625, -16.98], [6.625, -22.64] ],
        "107" : [ [0.0, -22.64], [0.0, -28.3], [6.625, -22.64], [6.625, -28.3] ],
        "108" : [ [0.0, -28.3], [0.0, -34], [6.625, -28.3], [6.625, -34] ],
        "109" : [ [6.625, 34.0], [6.625, 28.34], [13.25, 34.0], [13.25, 28.34] ],
        "110" : [ [6.625, 28.34], [6.625, 22.68], [13.25, 28.34], [13.25, 22.68] ],
        "111" : [ [6.625, 22.68], [6.625, 17.02], [13.25, 22.68], [13.25, 17.02] ],
        "112" : [ [6.625, 17.02], [6.625, 11.36], [13.25, 17.02], [13.25, 11.36] ],
        "113" : [ [6.625, 11.36], [6.625, 5.7], [13.25, 11.36], [13.25, 5.7] ],
        "114" : [ [6.625, 5.7], [6.625, 0.0], [13.25, 5.7], [13.25, 0.0] ],
        "115" : [ [6.625, 0.0], [6.625, -5.66], [13.25, 0.0], [13.25, -5.66] ],
        "116" : [ [6.625, -5.66], [6.625, -11.32], [13.25, -5.66], [13.25, -11.32] ],
        "117" : [ [6.625, -11.32], [6.625, -16.98], [13.25, -11.32], [13.25, -16.98] ],
        "118" : [ [6.625, -16.98], [6.625, -22.64], [13.25, -16.98], [13.25, -22.64] ],
        "119" : [ [6.625, -22.64], [6.625, -28.3], [13.25, -22.64], [13.25, -28.3] ],
        "120" : [ [6.625, -28.3], [6.625, -34], [13.25, -28.3], [13.25, -34] ],
        "121" : [ [13.25, 34.0], [13.25, 28.34], [19.875, 34.0], [19.875, 28.34] ],
        "122" : [ [13.25, 28.34], [13.25, 22.68], [19.875, 28.34], [19.875, 22.68] ],
        "123" : [ [13.25, 22.68], [13.25, 17.02], [19.875, 22.68], [19.875, 17.02] ],
        "124" : [ [13.25, 17.02], [13.25, 11.36], [19.875, 17.02], [19.875, 11.36] ],
        "125" : [ [13.25, 11.36], [13.25, 5.7], [19.875, 11.36], [19.875, 5.7] ],
        "126" : [ [13.25, 5.7], [13.25, 0.0], [19.875, 5.7], [19.875, 0.0] ],
        "127" : [ [13.25, 0.0], [13.25, -5.66], [19.875, 0.0], [19.875, -5.66] ],
        "128" : [ [13.25, -5.66], [13.25, -11.32], [19.875, -5.66], [19.875, -11.32] ],
        "129" : [ [13.25, -11.32], [13.25, -16.98], [19.875, -11.32], [19.875, -16.98] ],
        "130" : [ [13.25, -16.98], [13.25, -22.64], [19.875, -16.98], [19.875, -22.64] ],
        "131" : [ [13.25, -22.64], [13.25, -28.3], [19.875, -22.64], [19.875, -28.3] ],
        "132" : [ [13.25, -28.3], [13.25, -34], [19.875, -28.3], [19.875, -34] ],
        "133" : [ [19.875, 34.0], [19.875, 28.34], [26.5, 34.0], [26.5, 28.34] ],
        "134" : [ [19.875, 28.34], [19.875, 22.68], [26.5, 28.34], [26.5, 22.68] ],
        "135" : [ [19.875, 22.68], [19.875, 17.02], [26.5, 22.68], [26.5, 17.02] ],
        "136" : [ [19.875, 17.02], [19.875, 11.36], [26.5, 17.02], [26.5, 11.36] ],
        "137" : [ [19.875, 11.36], [19.875, 5.7], [26.5, 11.36], [26.5, 5.7] ],
        "138" : [ [19.875, 5.7], [19.875, 0.0], [26.5, 5.7], [26.5, 0.0] ],
        "139" : [ [19.875, 0.0], [19.875, -5.66], [26.5, 0.0], [26.5, -5.66] ],
        "140" : [ [19.875, -5.66], [19.875, -11.32], [26.5, -5.66], [26.5, -11.32] ],
        "141" : [ [19.875, -11.32], [19.875, -16.98], [26.5, -11.32], [26.5, -16.98] ],
        "142" : [ [19.875, -16.98], [19.875, -22.64], [26.5, -16.98], [26.5, -22.64] ],
        "143" : [ [19.875, -22.64], [19.875, -28.3], [26.5, -22.64], [26.5, -28.3] ],
        "144" : [ [19.875, -28.3], [19.875, -34], [26.5, -28.3], [26.5, -34] ],
        "145" : [ [26.5, 34.0], [26.5, 28.34], [33.125, 34.0], [33.123, 28.34] ],
        "146" : [ [26.5, 28.34], [26.5, 22.68], [33.125, 28.34], [33.125, 22.68] ],
        "147" : [ [26.5, 22.68], [26.5, 17.02], [33.125, 22.68], [33.125, 17.02] ],
        "148" : [ [26.5, 17.02], [26.5, 11.36], [33.125, 17.02], [33.125, 11.36] ],
        "149" : [ [26.5, 11.36], [26.5, 5.7], [33.125, 11.36], [33.125, 5.7] ],
        "150" : [ [26.5, 5.7], [26.5, 0.0], [33.125, 5.7], [33.125, 0.0] ],
        "151" : [ [26.5, 0.0], [26.5, -5.66], [33.125, 0.0], [33.125, -5.66] ],
        "152" : [ [26.5, -5.66], [26.5, -11.32], [33.125, -5.66], [33.125, -11.32] ],
        "153" : [ [26.5, -11.32], [26.5, -16.98], [33.125, -11.32], [33.125, -16.98] ],
        "154" : [ [26.5, -16.98], [26.5, -22.64], [33.125, -16.98], [33.125, -22.64] ],
        "155" : [ [26.5, -22.64], [26.5, -28.3], [33.125, -22.64], [33.125, -28.3] ],
        "156" : [ [26.5, -28.3], [26.5, -34], [33.125, -28.3], [33.125, -34] ],
        "157" : [ [33.125, 34.0], [33.125, 28.34], [39.75, 34.0], [39.75, 28.34] ],
        "158" : [ [33.125, 28.34], [33.125, 22.68], [39.75, 28.34], [39.75, 22.68] ],
        "159" : [ [33.125, 22.68], [33.125, 17.02], [39.75, 22.68], [39.75, 17.02] ],
        "160" : [ [33.125, 17.02], [33.125, 11.36], [39.75, 17.02], [39.75, 11.36] ],
        "161" : [ [33.125, 11.36], [33.125, 5.7], [39.75, 11.36], [39.75, 5.7] ],
        "162" : [ [33.125, 5.7], [33.125, 0.0], [39.75, 5.7], [39.75, 0.0] ],
        "163" : [ [33.125, 0.0], [33.125, -5.66], [39.75, 0.0], [39.75, -5.66] ],
        "164" : [ [33.125, -5.66], [33.125, -11.32], [39.75, -5.66], [39.75, -11.32] ],
        "165" : [ [33.125, -11.32], [33.125, -16.98], [39.75, -11.32], [39.75, -16.98] ],
        "166" : [ [33.125, -16.98], [33.125, -22.64], [39.75, -16.98], [39.75, -22.64] ],
        "167" : [ [33.125, -22.64], [33.125, -28.3], [39.75, -22.64], [39.75, -28.3] ],
        "168" : [ [33.125, -28.3], [33.125, -34], [39.75, -28.3], [39.75, -34] ],
        "169" : [ [39.75, 34.0], [39.75, 28.34], [46.375, 34.0], [46.375, 28.34] ],
        "170" : [ [39.75, 28.34], [39.75, 22.68], [46.375, 28.34], [46.375, 22.68] ],
        "171" : [ [39.75, 22.68], [39.75, 17.02], [46.375, 22.68], [46.375, 17.02] ],
        "172" : [ [39.75, 17.02], [39.75, 11.36], [46.375, 17.02], [46.375, 11.36] ],
        "173" : [ [39.75, 11.36], [39.75, 5.7], [46.375, 11.36], [46.375, 5.7] ],
        "174" : [ [39.75, 5.7], [39.75, 0.0], [46.375, 5.7], [46.375, 0.0] ],
        "175" : [ [39.75, 0.0], [39.75, -5.66], [46.375, 0.0], [46.375, -5.66] ],
        "176" : [ [39.75, -5.66], [39.75, -11.32], [46.375, -5.66], [46.375, -11.32] ],
        "177" : [ [39.75, -11.32], [39.75, -16.98], [46.375, -11.32], [46.375, -16.98] ],
        "178" : [ [39.75, -16.98], [39.75, -22.64], [46.375, -16.98], [46.375, -22.64] ],
        "179" : [ [39.75, -22.64], [39.75, -28.3], [46.375, -22.64], [46.375, -28.3] ],
        "180" : [ [39.75, -28.3], [39.75, -34], [46.375, -28.3], [46.375, -34] ],
        "181" : [ [46.375, 34.0], [46.375, 28.34], [53.0, 34.0], [53.0, 28.34] ],
        "182" : [ [46.375, 28.34], [46.375, 22.68], [53.0, 28.34], [53.0, 22.68] ],
        "183" : [ [46.375, 22.68], [46.375, 17.02], [53.0, 22.68], [53.0, 17.02] ],
        "184" : [ [46.375, 17.02], [46.375, 11.36], [53.0, 17.02], [53.0, 11.36] ],
        "185" : [ [46.375, 11.36], [46.375, 5.7], [53.0, 11.36], [53.0, 5.7] ],
        "186" : [ [46.375, 5.7], [46.375, 0.0], [53.0, 5.7], [53.0, 0.0] ],
        "187" : [ [46.375, 0.0], [46.375, -5.66], [53.0, 0.0], [53.0, -5.66] ],
        "188" : [ [46.375, -5.66], [46.375, -11.32], [53.0, -5.66], [53.0, -11.32] ],
        "189" : [ [46.375, -11.32], [46.375, -16.98], [53.0, -11.32], [53.0, -16.98] ],
        "190" : [ [46.375, -16.98], [46.375, -22.64], [53.0, -16.98], [53.0, -22.64] ],
        "191" : [ [46.375, -22.64], [46.375, -28.3], [53.0, -22.64], [53.0, -28.3] ],
        "192" : [ [46.375, -28.3], [46.375, -34], [53.0, -28.3], [53.0, -34] ]
    }

def zone_to_xt(zone):
    xt = {
        "1" : ".001",
        "2" : ".002",
        "3" : ".002",
        "4" : ".002",
        "5" : ".003",
        "6" : ".004",
        "7" : ".004",
        "8" : ".004",
        "9" : ".002",
        "10" : ".002",
        "11" : ".002",
        "12" : ".001",
        "13" : ".002",
        "14" : ".002",
        "15" : ".003",
        "16" : ".003",
        "17" : ".003",
        "18" : ".004",
        "19" : ".004",
        "20" : ".003",
        "21" : ".003",
        "22" : ".003",
        "23" : ".002",
        "24" : ".002",
        "25" : ".002",
        "26" : ".003",
        "27" : ".003",
        "28" : ".003",
        "29" : ".004",
        "30" : ".004",
        "31" : ".004",
        "32" : ".004",
        "33" : ".004",
        "34" : ".003",
        "35" : ".003",
        "36" : ".003",
        "37" : ".003",
        "38" : ".003",
        "39" : ".004",
        "40" : ".004",
        "41" : ".004",
        "42" : ".004",
        "43" : ".004",
        "44" : ".004",
        "45" : ".004",
        "46" : ".004",
        "47" : ".003",
        "48" : ".003",
        "49" : ".003",
        "50" : ".004",
        "51" : ".004",
        "52" : ".005",
        "53" : ".005",
        "54" : ".005",
        "55" : ".005",
        "56" : ".005",
        "57" : ".005",
        "58" : ".005",
        "59" : ".004",
        "60" : ".004",
        "61" : ".004",
        "62" : ".005",
        "63" : ".005",
        "64" : ".006",
        "65" : ".006",
        "66" : ".006",
        "67" : ".006",
        "68" : ".006",
        "69" : ".006",
        "70" : ".006",
        "71" : ".005",
        "72" : ".004",
        "73" : ".005",
        "74" : ".006",
        "75" : ".006",
        "76" : ".007",
        "77" : ".007",
        "78" : ".007",
        "79" : ".007",
        "80" : ".007",
        "81" : ".007",
        "82" : ".007",
        "83" : ".006",
        "84" : ".005",
        "85" : ".006",
        "86" : ".007",
        "87" : ".007",
        "88" : ".008",
        "89" : ".008",
        "90" : ".008",
        "91" : ".008",
        "92" : ".008",
        "93" : ".008",
        "94" : ".008",
        "95" : ".007",
        "96" : ".007",
        "97" : ".007",
        "98" : ".008",
        "99" : ".009",
        "100" : ".009",
        "101" : ".01",
        "102" : ".01",
        "103" : ".009",
        "104" : ".01",
        "105" : ".009",
        "106" : ".009",
        "107" : ".009",
        "108" : ".008",
        "109" : ".009",
        "110" : ".01",
        "111" : ".01",
        "112" : ".011",
        "113" : ".011",
        "114" : ".012",
        "115" : ".012",
        "116" : ".012",
        "117" : ".011",
        "118" : ".011",
        "119" : ".01",
        "120" : ".009",
        "121" : ".011",
        "122" : ".012",
        "123" : ".013",
        "124" : ".014",
        "125" : ".014",
        "126" : ".014",
        "127" : ".014",
        "128" : ".014",
        "129" : ".014",
        "130" : ".013",
        "131" : ".012",
        "132" : ".012",
        "133" : ".013",
        "134" : ".015",
        "135" : ".016",
        "136" : ".018",
        "137" : ".019",
        "138" : ".019",
        "139" : ".02",
        "140" : ".02",
        "141" : ".018",
        "142" : ".017",
        "143" : ".016",
        "144" : ".014",
        "145" : ".016",
        "146" : ".018",
        "147" : ".021",
        "148" : ".024",
        "149" : ".027",
        "150" : ".034",
        "151" : ".034",
        "152" : ".028",
        "153" : ".025",
        "154" : ".021",
        "155" : ".019",
        "156" : ".016",
        "157" : ".017",
        "158" : ".021",
        "159" : ".025",
        "160" : ".029",
        "161" : ".055",
        "162" : ".077",
        "163" : ".085",
        "164" : ".062",
        "165" : ".035",
        "166" : ".026",
        "167" : ".021",
        "168" : ".018",
        "169" : ".017",
        "170" : ".02",
        "171" : ".027",
        "172" : ".039",
        "173" : ".091",
        "174" : ".143",
        "175" : ".134",
        "176" : ".095",
        "177" : ".042",
        "178" : ".026",
        "179" : ".02",
        "180" : ".017",
        "181" : ".016",
        "182" : ".021",
        "183" : ".024",
        "184" : ".031",
        "185" : ".071",
        "186" : ".332",
        "187" : ".32",
        "188" : ".085",
        "189" : ".033",
        "190" : ".022",
        "191" : ".02",
        "192" : ".017"
    }

    return xt[zone]

def get_zone(coords):
    x, y = coords
    zones = xt_map_zones()

    for zone in zones:
        rect = zones[zone]
        if x > rect[0][0] and x <= rect[2][0]:
            if y > rect[1][1] and y <= rect[0][1]:
                return zone

def get_xt(coords, invert = False):
    x, y = coords
    if invert:
        x *= -1
        y *= -1
        coords = (x, y)

    if( x < -53 or x > 53 ):
        return 0
    
    if( y < -34 or y > 34 ):
        return 0
    
    boxes = get_four_boxes(coords)

    corners = []
    for box in boxes:
        corners.append( { "value" : box["value"],  "point" : get_center(box["box"])} )

    #Check if math isn't needed
    all_same_value = True
    corner_one_value = corners[0]["value"]
    for corner in corners:
        if corner["value"] != corner_one_value:
            all_same_value = False

    if all_same_value:
        return float(corner_one_value)

    pts = [(float(d['value']), d['point'][0], d['point'][1]) for d in corners]

    xs = [p[1] for p in pts]
    ys = [p[2] for p in pts]
    x0, x1 = min(xs), max(xs)
    y0, y1 = min(ys), max(ys)

    mapping = {(px, py): val for val, px, py in pts}

    if x1 == x0 or y1 == y0:
        return sum(mapping.values()) / 4.0

    v00 = mapping[(x0, y0)]
    v10 = mapping[(x1, y0)]
    v01 = mapping[(x0, y1)]
    v11 = mapping[(x1, y1)]

    u = (x - x0) / (x1 - x0)
    v = (y - y0) / (y1 - y0)

    return round((1-u)*(1-v)*v00 + u*(1-v)*v10 + (1-u)*v*v01 + u*v*v11, 4)
